<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FileMaster - Vehicle Document Collection</title>
    <style>
        /* Reset and base styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
            min-height: 100vh;
            color: #334155;
        }

        .container {
            max-width: 28rem;
            margin: 0 auto;
            padding: 1.5rem 1rem;
        }

        /* Header card */
        .header-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border-radius: 1rem;
            border: 1px solid #e2e8f0;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .header-flex {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .title {
            font-size: 1.25rem;
            font-weight: bold;
            /* Automotive gradient text */
            background: linear-gradient(90deg, #14b8a6, #f97316);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 0.875rem;
            color: #64748b;
        }

        .progress-text {
            text-align: right;
        }

        .progress-number {
            font-size: 1.5rem;
            font-weight: bold;
            /* Automotive teal color */
            color: #14b8a6;
        }

        .progress-label {
            font-size: 0.75rem;
            color: #64748b;
        }

        /* Progress bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 9999px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            /* Automotive gradient */
            background: linear-gradient(90deg, #14b8a6, #f97316);
            border-radius: 9999px;
            transition: width 1s ease-out;
        }

        /* Section cards */
        .section-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border-radius: 1rem;
            border: 2px solid #e2e8f0;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .section-card.completed {
            border-color: #bbf7d0;
            background: rgba(240, 253, 244, 0.9);
        }

        .section-card:hover {
            border-color: #cbd5e1;
        }

        /* Upload item cards */
        .upload-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border-radius: 1rem;
            border: 2px solid #e2e8f0;
            padding: 1.5rem;
            transition: all 0.5s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }

        .upload-card.completed {
            border-color: #bbf7d0;
            background: rgba(240, 253, 244, 0.9);
            transform: scale(0.98);
        }

        .upload-card.uploading {
            /* Automotive teal for uploading state */
            border-color: #14b8a6;
            background: rgba(212, 252, 250, 0.9);
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .upload-card.drag-over {
            /* Automotive orange for drag over */
            border-color: #f97316;
            background: rgba(255, 237, 213, 0.9);
            transform: scale(1.02);
            animation: pulse-border 2s ease-in-out infinite;
        }

        @keyframes pulse-border {
            0%, 100% { border-color: #14b8a6; }
            50% { border-color: #f97316; }
        }

        /* Section headers */
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .section-icon {
            font-size: 1.25rem;
        }

        .section-title {
            font-weight: 600;
            color: #1e293b;
        }

        .section-status {
            margin-left: auto;
            color: #059669;
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Form fields */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }

        .label-text {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .required {
            color: #ef4444;
        }

        .field-status {
            font-size: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            font-size: 1rem;
            transition: all 0.2s ease;
            background: #ffffff;
        }

        .form-input:focus {
            outline: none;
            /* Automotive teal focus */
            border-color: #14b8a6;
            background: #f0fdfa;
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
        }

        .form-input.valid {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .form-input.error {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .form-helper {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: #6b7280;
        }

        .form-error {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: #ef4444;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Toggle buttons */
        .toggle-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .toggle-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            background: #f8fafc;
            color: #64748b;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .toggle-btn.active {
            /* Automotive teal for active state */
            border-color: #14b8a6;
            background: #f0fdfa;
            color: #0f766e;
            transform: scale(1.02);
        }

        .toggle-btn:hover {
            border-color: #cbd5e1;
        }

        /* Conditional sections */
        .conditional-section {
            border-top: 1px solid #e2e8f0;
            padding-top: 1.5rem;
            margin-top: 1.5rem;
        }

        .conditional-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            /* Automotive orange for conditional header */
            color: #f97316;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        /* Upload area styles */
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .item-icon {
            padding: 0.75rem;
            border-radius: 0.75rem;
            font-size: 1.5rem;
        }

        .item-icon.default { 
            /* Automotive teal background */
            background: #ccfbf1; 
        }
        .item-icon.completed { 
            background: #dcfce7; 
        }

        .item-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }

        .item-description {
            font-size: 0.875rem;
            color: #64748b;
        }

        .status-badge {
            color: #059669;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .upload-area:hover {
            border-color: #94a3b8;
        }

        .upload-area.drag-over {
            /* Automotive orange for drag over */
            border-color: #f97316;
            background: rgba(255, 237, 213, 0.5);
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .upload-text {
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .upload-subtext {
            color: #94a3b8;
            font-size: 0.75rem;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-size: 0.875rem;
        }

        .btn-file {
            background: #f1f5f9;
            color: #475569;
        }

        .btn-file:hover {
            background: #e2e8f0;
        }

        .btn-camera {
            /* Automotive teal for camera button */
            background: #ccfbf1;
            color: #0f766e;
        }

        .btn-camera:hover {
            background: #99f6e4;
        }

        /* Progress and completion styles */
        .progress-section {
            /* Automotive teal background */
            background: #f0fdfa;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .progress-status {
            color: #64748b;
        }

        .progress-percent {
            font-weight: 500;
            /* Automotive teal */
            color: #0f766e;
        }

        .upload-progress-bar {
            width: 100%;
            height: 6px;
            /* Automotive teal progress bar background */
            background: #ccfbf1;
            border-radius: 9999px;
            overflow: hidden;
        }

        .upload-progress-fill {
            height: 100%;
            /* Automotive teal */
            background: #14b8a6;
            border-radius: 9999px;
            transition: width 0.3s ease;
        }

        .completion-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f0fdf4;
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .completion-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #15803d;
            font-weight: 500;
        }

        .reset-btn {
            color: #059669;
            font-size: 0.875rem;
            background: none;
            border: none;
            cursor: pointer;
        }

        .reset-btn:hover {
            color: #047857;
        }

        /* Final completion */
        .final-completion {
            text-align: center;
            padding: 2rem 0;
        }

        .completion-icon {
            width: 5rem;
            height: 5rem;
            /* Automotive gradient */
            background: linear-gradient(135deg, #14b8a6, #f97316);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2.5rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .completion-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .completion-text {
            color: #64748b;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .submit-btn {
            /* Automotive gradient */
            background: linear-gradient(135deg, #14b8a6, #f97316);
            color: white;
            font-weight: 600;
            padding: 0.75rem 2rem;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(20, 184, 166, 0.3);
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(20, 184, 166, 0.4);
        }

        .submit-btn:disabled {
            background: #e2e8f0;
            color: #64748b;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            /* Automotive teal */
            background: #14b8a6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Hidden elements */
        .hidden {
            display: none !important;
        }

        /* Utility classes */
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with Progress -->
        <div class="header-card">
            <div class="header-flex">
                <div>
                    <div class="title">Vehicle Document Collection</div>
                    <div class="subtitle">Request #VDC-2025-001</div>
                </div>
                <div class="progress-text">
                    <div class="progress-number" id="progress-number">0%</div>
                    <div class="progress-label">Complete</div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
        </div>

        <!-- Vehicle Titling Information Form -->
        <div class="section-card" id="form-section">
            <div class="section-header">
                <span class="section-icon">üöó</span>
                <span class="section-title">Vehicle Titling Information</span>
                <span class="section-status hidden" id="form-status">‚úì Complete</span>
            </div>

            <div class="form-group">
                <label class="form-label">
                    <span class="label-text">
                        üë§ Name exactly as you'd like it on the title <span class="required">*</span>
                    </span>
                    <span class="field-status" id="name-status"></span>
                </label>
                <input 
                    type="text" 
                    class="form-input" 
                    id="title-name" 
                    placeholder="John F. Stewart"
                    value="John F. Stewart"
                >
                <div class="form-helper">This will appear exactly as entered on your vehicle title</div>
                <div class="form-error hidden" id="name-error">
                    ‚ö†Ô∏è <span></span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">
                    <span class="label-text">
                        üìç Titling Address <span class="required">*</span>
                    </span>
                    <span class="field-status" id="address-status"></span>
                </label>
                <input 
                    type="text" 
                    class="form-input" 
                    id="title-address" 
                    placeholder="123 Main Street, Dayton, OH 45402"
                >
                <div class="form-helper">Address where you want the title mailed</div>
                <div class="form-error hidden" id="address-error">
                    ‚ö†Ô∏è <span></span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">
                    <span class="label-text">
                        üìß Email for Warranty/Recall Information <span class="required">*</span>
                    </span>
                    <span class="field-status" id="email-status"></span>
                </label>
                <input 
                    type="email" 
                    class="form-input" 
                    id="email" 
                    placeholder="john.stewart@example.com"
                >
                <div class="form-helper">Toyota will use this for important safety notices</div>
                <div class="form-error hidden" id="email-error">
                    ‚ö†Ô∏è <span></span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">
                    <span class="label-text">
                        üõ°Ô∏è Setup a transfer upon death?
                    </span>
                </label>
                <div class="form-helper" style="margin-bottom: 1rem;">
                    Setup automatic transfer of vehicle ownership to a beneficiary upon death?
                </div>
                
                <div class="toggle-group">
                    <button class="toggle-btn" id="tod-yes" onclick="setTOD(true)">
                        ‚úì Yes, set up TOD
                    </button>
                    <button class="toggle-btn" id="tod-no" onclick="setTOD(false)">
                        No, skip TOD
                    </button>
                </div>

                <!-- Conditional TOD Fields -->
                <div class="conditional-section hidden" id="tod-fields">
                    <div class="conditional-header">
                        ‚û§ Beneficiary Information
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-text">
                                üë§ Beneficiary's Full Name <span class="required">*</span>
                            </span>
                            <span class="field-status" id="tod-name-status"></span>
                        </label>
                        <input 
                            type="text" 
                            class="form-input" 
                            id="tod-name" 
                            placeholder="Jane Smith Stewart"
                        >
                        <div class="form-helper">Legal name of the person who will inherit the vehicle</div>
                        <div class="form-error hidden" id="tod-name-error">
                            ‚ö†Ô∏è <span></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-text">
                                üî¢ Social Security Number <span class="required">*</span>
                            </span>
                            <span class="field-status" id="tod-ssn-status"></span>
                        </label>
                        <input 
                            type="text" 
                            class="form-input" 
                            id="tod-ssn" 
                            placeholder="XXX-XX-XXXX"
                            maxlength="11"
                        >
                        <div class="form-helper">Required for title transfer processing</div>
                        <div class="form-error hidden" id="tod-ssn-error">
                            ‚ö†Ô∏è <span></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-text">
                                üìÖ Date of Birth <span class="required">*</span>
                            </span>
                            <span class="field-status" id="tod-birth-status"></span>
                        </label>
                        <input 
                            type="date" 
                            class="form-input" 
                            id="tod-birth"
                        >
                        <div class="form-helper">Used to verify beneficiary identity</div>
                        <div class="form-error hidden" id="tod-birth-error">
                            ‚ö†Ô∏è <span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Items -->
        <div id="upload-items">
            <!-- Items will be dynamically generated -->
        </div>

        <!-- Final Completion -->
        <div class="final-completion hidden" id="final-completion">
            <div class="completion-icon">üéâ</div>
            <div class="completion-title">All Documentation Complete!</div>
            <div class="completion-text">
                Thank you for submitting your vehicle documents and information. Our team will review everything and contact you within 24 hours to finalize your purchase.
            </div>
            <button class="submit-btn" id="final-submit-btn" onclick="submitRequest()">
                Submit Complete Package
            </button>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast">
            <span id="toast-message"></span>
        </div>
    </div>

    <script>
        // App state
        const state = {
            formData: {
                titleName: 'John F. Stewart',
                titleAddress: '',
                email: '',
                setupTOD: null,
                todName: '',
                todSSN: '',
                todBirthdate: ''
            },
            formErrors: {},
            todFieldsVisible: false,
            uploadItems: [
                {
                    id: 1,
                    title: "Driver's License",
                    description: "Upload clear photos of front and back",
                    icon: "üÜî",
                    completed: false,
                    uploading: false,
                    progress: 0,
                    dragOver: false
                },
                {
                    id: 2,
                    title: "Insurance Card",
                    description: "Upload front and back of insurance card",
                    icon: "üìÑ",
                    completed: false,
                    uploading: false,
                    progress: 0,
                    dragOver: false
                },
                {
                    id: 3,
                    title: "Proof of Income",
                    description: "Upload recent pay stub or tax return",
                    icon: "üí∞",
                    completed: false,
                    uploading: false,
                    progress: 0,
                    dragOver: false
                }
            ]
        };

        // Form validation rules
        const validationRules = {
            titleName: (value) => {
                if (!value || value.trim().length < 2) return 'Name must be at least 2 characters';
                return null;
            },
            titleAddress: (value) => {
                if (!value || value.trim().length < 5) return 'Please enter a complete address';
                return null;
            },
            email: (value) => {
                if (!value) return 'Email is required';
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) return 'Please enter a valid email address';
                return null;
            },
            todName: (value) => {
                if (state.formData.setupTOD === true && (!value || value.trim().length < 2)) {
                    return 'Beneficiary name is required';
                }
                return null;
            },
            todSSN: (value) => {
                if (state.formData.setupTOD === true) {
                    if (!value) return 'SSN is required for TOD setup';
                    const ssnRegex = /^\d{3}-\d{2}-\d{4}$/;
                    if (!ssnRegex.test(value)) return 'Please enter a valid SSN (XXX-XX-XXXX)';
                }
                return null;
            },
            todBirthdate: (value) => {
                if (state.formData.setupTOD === true && !value) {
                    return 'Date of birth is required for TOD setup';
                }
                return null;
            }
        };

        // Auto-format SSN
        function formatSSN(value) {
            const cleaned = value.replace(/\D/g, '');
            const match = cleaned.match(/^(\d{0,3})(\d{0,2})(\d{0,4})$/);
            if (match) {
                return [match[1], match[2], match[3]].filter(Boolean).join('-');
            }
            return value;
        }

        // Validate single field
        function validateField(fieldName, value) {
            const rule = validationRules[fieldName];
            if (rule) {
                const error = rule(value);
                if (error) {
                    state.formErrors[fieldName] = error;
                } else {
                    delete state.formErrors[fieldName];
                }
                return !error;
            }
            return true;
        }

        // Update field UI
        function updateFieldUI(fieldName, isValid, hasValue) {
            const input = document.getElementById(fieldName.replace(/([A-Z])/g, '-$1').toLowerCase());
            const status = document.getElementById(fieldName.replace(/([A-Z])/g, '-$1').toLowerCase() + '-status');
            const error = document.getElementById(fieldName.replace(/([A-Z])/g, '-$1').toLowerCase() + '-error');
            
            if (input) {
                input.classList.remove('valid', 'error');
                if (isValid && hasValue) {
                    input.classList.add('valid');
                } else if (!isValid) {
                    input.classList.add('error');
                }
            }
            
            if (status) {
                status.textContent = isValid && hasValue ? '‚úÖ' : '';
            }
            
            if (error) {
                if (!isValid && state.formErrors[fieldName]) {
                    error.classList.remove('hidden');
                    error.querySelector('span').textContent = state.formErrors[fieldName];
                } else {
                    error.classList.add('hidden');
                }
            }
        }

        // Check form completion
        function isFormComplete() {
            const requiredFields = ['titleName', 'titleAddress', 'email'];
            if (state.formData.setupTOD === null) return false;
            
            if (state.formData.setupTOD === true) {
                requiredFields.push('todName', 'todSSN', 'todBirthdate');
            }
            
            for (const field of requiredFields) {
                if (!state.formData[field] || state.formErrors[field]) {
                    return false;
                }
            }
            
            return true;
        }

        // Update form status
        function updateFormStatus() {
            const formComplete = isFormComplete();
            const formSection = document.getElementById('form-section');
            const formStatus = document.getElementById('form-status');
            
            if (formComplete) {
                formSection.classList.add('completed');
                formStatus.classList.remove('hidden');
            } else {
                formSection.classList.remove('completed');
                formStatus.classList.add('hidden');
            }
            
            updateProgress();
        }

        // Calculate overall progress
        function getOverallProgress() {
            let totalItems = state.uploadItems.length + 1; // +1 for form
            let completedItems = 0;
            
            // Count completed uploads
            completedItems += state.uploadItems.filter(item => item.completed).length;
            
            // Count form completion
            if (isFormComplete()) completedItems += 1;
            
            return Math.round((completedItems / totalItems) * 100);
        }

        // Check if everything is completed
        function isEverythingComplete() {
            return isFormComplete() && state.uploadItems.every(item => item.completed);
        }

        // Update progress display
        function updateProgress() {
            const progress = getOverallProgress();
            document.getElementById('progress-number').textContent = progress + '%';
            document.getElementById('progress-fill').style.width = progress + '%';
            
            const finalSubmitBtn = document.getElementById('final-submit-btn');
            if (finalSubmitBtn) {
                finalSubmitBtn.disabled = !isEverythingComplete();
            }
            
            if (isEverythingComplete()) {
                document.getElementById('final-completion').classList.remove('hidden');
                document.getElementById('final-completion').classList.add('slide-up');
            } else {
                document.getElementById('final-completion').classList.add('hidden');
            }
        }

        // Setup form event listeners
        function setupFormListeners() {
            // Title name
            const titleNameInput = document.getElementById('title-name');
            titleNameInput.addEventListener('input', (e) => {
                state.formData.titleName = e.target.value;
                const isValid = validateField('titleName', e.target.value);
                updateFieldUI('titleName', isValid, e.target.value.trim().length > 0);
                updateFormStatus();
            });

            // Title address
            const titleAddressInput = document.getElementById('title-address');
            titleAddressInput.addEventListener('input', (e) => {
                state.formData.titleAddress = e.target.value;
                const isValid = validateField('titleAddress', e.target.value);
                updateFieldUI('titleAddress', isValid, e.target.value.trim().length > 0);
                updateFormStatus();
            });

            // Email
            const emailInput = document.getElementById('email');
            emailInput.addEventListener('input', (e) => {
                state.formData.email = e.target.value.toLowerCase().trim();
                emailInput.value = state.formData.email;
                const isValid = validateField('email', state.formData.email);
                updateFieldUI('email', isValid, state.formData.email.length > 0);
                updateFormStatus();
            });

            // TOD fields
            const todNameInput = document.getElementById('tod-name');
            todNameInput.addEventListener('input', (e) => {
                state.formData.todName = e.target.value;
                const isValid = validateField('todName', e.target.value);
                updateFieldUI('todName', isValid, e.target.value.trim().length > 0);
                updateFormStatus();
            });

            const todSSNInput = document.getElementById('tod-ssn');
            todSSNInput.addEventListener('input', (e) => {
                const formatted = formatSSN(e.target.value);
                e.target.value = formatted;
                state.formData.todSSN = formatted;
                const isValid = validateField('todSSN', formatted);
                updateFieldUI('todSSN', isValid, formatted.length > 0);
                updateFormStatus();
            });

            const todBirthInput = document.getElementById('tod-birth');
            todBirthInput.addEventListener('input', (e) => {
                state.formData.todBirthdate = e.target.value;
                const isValid = validateField('todBirthdate', e.target.value);
                updateFieldUI('todBirthdate', isValid, e.target.value.length > 0);
                updateFormStatus();
            });
        }

        // Set TOD choice
        function setTOD(choice) {
            state.formData.setupTOD = choice;
            state.todFieldsVisible = choice;
            
            // Update button states
            document.getElementById('tod-yes').classList.toggle('active', choice === true);
            document.getElementById('tod-no').classList.toggle('active', choice === false);
            
            // Show/hide conditional fields
            const todFields = document.getElementById('tod-fields');
            if (choice === true) {
                todFields.classList.remove('hidden');
                todFields.classList.add('slide-up');
            } else {
                todFields.classList.add('hidden');
                // Clear TOD data if not needed
                state.formData.todName = '';
                state.formData.todSSN = '';
                state.formData.todBirthdate = '';
                document.getElementById('tod-name').value = '';
                document.getElementById('tod-ssn').value = '';
                document.getElementById('tod-birth').value = '';
            }
            
            updateFormStatus();
        }

        // Show toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // File upload functions (same as before)
        function uploadFiles(files, item) {
            if (files.length === 0) return;
            
            item.uploading = true;
            item.progress = 0;
            renderUploadItems();

            const uploadInterval = setInterval(() => {
                item.progress += Math.random() * 25;
                
                if (item.progress >= 100) {
                    item.progress = 100;
                    clearInterval(uploadInterval);
                    
                    setTimeout(() => {
                        item.uploading = false;
                        item.completed = true;
                        renderUploadItems();
                        updateProgress();
                        showToast(`${item.title} uploaded successfully!`);
                    }, 500);
                } else {
                    renderUploadItems();
                }
            }, 200);
        }

        function setupDragAndDrop(element, item) {
            element.addEventListener('dragover', (e) => {
                e.preventDefault();
                item.dragOver = true;
                renderUploadItems();
            });

            element.addEventListener('dragleave', (e) => {
                e.preventDefault();
                item.dragOver = false;
                renderUploadItems();
            });

            element.addEventListener('drop', (e) => {
                e.preventDefault();
                item.dragOver = false;
                const files = Array.from(e.dataTransfer.files);
                uploadFiles(files, item);
            });
        }

        function handleFileChange(event, item) {
            const files = Array.from(event.target.files);
            uploadFiles(files, item);
        }

        function startCamera(item) {
            showToast("Camera feature would open here");
            setTimeout(() => {
                uploadFiles([new File([""], "camera-photo.jpg", { type: "image/jpeg" })], item);
            }, 1000);
        }

        function resetUploadItem(item) {
            item.completed = false;
            item.uploading = false;
            item.progress = 0;
            renderUploadItems();
            updateProgress();
        }

        function submitRequest() {
            showToast("Complete vehicle documentation submitted successfully!");
        }

        // Render upload items
        function renderUploadItems() {
            const container = document.getElementById('upload-items');
            container.innerHTML = '';

            state.uploadItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = `upload-card ${item.completed ? 'completed' : ''} ${item.uploading ? 'uploading' : ''} ${item.dragOver ? 'drag-over' : ''}`;
                
                itemElement.innerHTML = `
                    <div class="item-header">
                        <div class="item-info">
                            <div class="item-icon ${item.completed ? 'completed' : 'default'}">
                                ${item.completed ? '‚úÖ' : item.icon}
                            </div>
                            <div>
                                <div class="item-title">${item.title}</div>
                                <div class="item-description">${item.description}</div>
                            </div>
                        </div>
                        ${item.completed ? '<div class="status-badge">‚úì Done</div>' : ''}
                    </div>

                    ${item.uploading ? `
                        <div class="progress-section slide-up">
                            <div class="progress-info">
                                <span class="progress-status">Uploading...</span>
                                <span class="progress-percent">${Math.round(item.progress)}%</span>
                            </div>
                            <div class="upload-progress-bar">
                                <div class="upload-progress-fill" style="width: ${item.progress}%"></div>
                            </div>
                        </div>
                    ` : ''}

                    ${!item.completed && !item.uploading ? `
                        <div class="upload-area" data-item-id="${item.id}">
                            <div class="upload-icon">üìé</div>
                            <div class="upload-text">Drop files here or click to browse</div>
                            <div class="upload-subtext">Supports JPG, PNG, PDF up to 10MB</div>
                            <input type="file" class="hidden" id="file-input-${item.id}" multiple accept="image/*,.pdf">
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn btn-file" onclick="document.getElementById('file-input-${item.id}').click()">
                                üìÅ Choose File
                            </button>
                            <button class="action-btn btn-camera" onclick="startCamera(state.uploadItems.find(i => i.id === ${item.id}))">
                                üì∑ Take Photo
                            </button>
                        </div>
                    ` : ''}

                    ${item.completed ? `
                        <div class="completion-section slide-up">
                            <div class="completion-status">
                                ‚úÖ Successfully uploaded
                            </div>
                            <button class="reset-btn" onclick="resetUploadItem(state.uploadItems.find(i => i.id === ${item.id}))">
                                üîÑ Replace
                            </button>
                        </div>
                    ` : ''}
                `;

                // Setup event listeners
                if (!item.completed && !item.uploading) {
                    const uploadArea = itemElement.querySelector('.upload-area');
                    const fileInput = itemElement.querySelector(`#file-input-${item.id}`);
                    
                    setupDragAndDrop(uploadArea, item);
                    
                    uploadArea.addEventListener('click', () => {
                        fileInput.click();
                    });
                    
                    fileInput.addEventListener('change', (e) => {
                        handleFileChange(e, item);
                    });
                }

                container.appendChild(itemElement);
            });
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            setupFormListeners();
            renderUploadItems();
            updateProgress();
            
            // Validate initial form data
            Object.keys(state.formData).forEach(field => {
                if (state.formData[field]) {
                    validateField(field, state.formData[field]);
                    updateFieldUI(field, !state.formErrors[field], !!state.formData[field]);
                }
            });
            updateFormStatus();
        });
    </script>
</body>
</html>
