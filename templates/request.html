{% extends 'base.html' %}
{% block content %}
{% set modules_json = modules_data | tojson %}
<div class="layout" x-data="requestPage({{ modules_json|safe }})">
    <div class="queue">
        <h2>Requested Items</h2>
        <ul>
            <template x-for="m in modules" :key="m.id">
                <li>
                    <span x-text="m.completed ? '✓' : '□'"></span>
                    <a :href="'{{ url_for('view_request', token=req.token) }}?module=' + m.id" x-text="m.description"></a>
                </li>
            </template>
        </ul>
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" :style="{width: progress + '%'}"></div>
            </div>
            <p x-text="progress + '% complete'"></p>
        </div>
        {% if req.expires_at %}
            <p class="expiration">
                Expires {{ req.expires_at.strftime('%Y-%m-%d %H:%M UTC') }}
            </p>
        {% else %}
            <p class="expiration">No expiration.</p>
        {% endif %}
    </div>
    <div class="module">
        {% if selected %}
            {{ module_html|safe }}
        {% else %}
            <p>All tasks complete!</p>
        {% endif %}
    </div>
</div>
<script>
function requestPage(modules) {
    return {
        modules: modules,
        get progress() {
            if (this.modules.length === 0) return 100;
            let done = this.modules.filter(m => m.completed).length;
            return Math.round((done / this.modules.length) * 100);
        }
    }
}
</script>
{% endblock %}
